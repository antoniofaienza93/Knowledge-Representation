<html>

<body>
    <h1> RULE REACTOR EXAMPLE </h1>
    <p>Rule base adapted from: http://www.csis.ysu.edu/~john/824/examples/EMH1.txt</p>

    <p>Open in debugger to see rule activity</p>

    <script src="lib/rule-reactor.js"></script>

    <script id="example">

        // define the business object model consisting of
        // Day, Timetable, Professor, Discipline. 

        function Day(name) {
            this._name = name;
            this._discipline = null;
        }

        function Timetable() {

            this.monday = null;
            this.tuesday = null;
            this.wednesday = null;
            this.thursday = null;
            this.friday = null;

            this.course = null;
        }

        // firstName,surName,id_professor,role
        function Professor(firstName, surname, id, role) {
            this._firstName = firstName;
            this._surname = surname;
            this._id = id;
            this._role = role;

            this.nolessons = null;

            this.getFirstName = function () {
                return this._firstName;
            };
        }

        // id_discipline,disciplineName,semester,obligatory,totalHours,weeksHours,cfu,year,course,teacher
        function Discipline(id, name, semester, obligatory, totalHours, weeksHours, cfu, year, course, teacher) {
            this._id = id;
            this._name = name;
            this._semester = semester;
            this._obligatory = obligatory;
            this._totalHours = totalHours;
            this._weeksHours = weeksHours;
            this._cfu = cfu;
            this._year = year;
            this._course = course;
            this._teacher = teacher;
        }

        // id_room,className,address,capacity,wifi,wired
        function Classroom(id, name, address, capacity, wifi, wired) {
            this._id = id;
            this._name = name;
            this._address = address;
            this._capacity = capacity;
            this._wifi = wifi;
            this._wired = wired;
        }


        function Course(id, name) {
            this._id = id;
            this._name = name;
        }

        // DOMAIN= Come primo parametro prende quelle che sono le classi che devono essere prese
        // BOOST = Questo può aumentare le prestazioni fino al 25%; tuttavia, i punti di interruzione impostati nelle condizioni delle regole non funzioneranno più.
        //  Quindi, questo dovrebbe essere un passo finale nello sviluppo.
        var reactor = new RuleReactor();

        function assert() { return reactor.assert.apply(reactor, arguments); }
        function not() { return reactor.not.apply(reactor, arguments); }
        function exists() { return reactor.exists.apply(reactor, arguments); }
        function forAll() { return reactor.forAll.apply(reactor, arguments); }

        // https://github.com/anywhichway/rule-reactor#debugging-and-testing
        reactor.trace(3);


        // In its simplest form, a rule is just boolean condition function which is a
        // "template" that the inference engine will try to match to some
        // fact. And, a function to execute if the condition is true. In this case, 
        // it matches a Patient with specific values for fever, spots, and innoculated 
        // and we modify the matching Patient to have the diagnosis measles.

        reactor.createRule("prova", 0, { s: Timetable },
            function (s) {
                // console.log("TRIGGER PROVA D MAMT");
                return s.monday == null;

            },
            function (s) {

                s.monday = new Day("Lunedi");
            });

        reactor.createRule("ASSOCIAMATERIA", 0, { d: Day},
            function (d) {
                return d._name == "Lunedi"
            },
            function (d) {
                d._discipline = new Discipline("0000", "RDC", "primo", true, 45, 5, 9000, 1)
            });

        reactor.createRule("stop", -1, {},
            function () {
                return not(exists({ tt: Timetable },
                    function (tt) { return tt.monday == null; }));
            },
            function () {
                reactor.stop();
            });

        var tt = new Timetable();
        var c = new Course("8028", "Informatica Magistrale");
        var p = new Professor("Mauro", "Gaspari", "00001", "ordinario");
        var m = new Discipline("0000", "RDC", "primo", true, 45, 5, 9000, 1);
        m.teacher = p;
        m.course = c;

        tt.course = c;
        reactor.assert(tt);

        reactor.run(Infinity, true, function () {
            var output = JSON.stringify(tt);
            console.log(output);
            document.write(output);

        });



    </script>

    <script>
        // document.write("<pre>" + document.getElementById("example").textContent + "</pre>"); 
    </script>
</body>

</html>